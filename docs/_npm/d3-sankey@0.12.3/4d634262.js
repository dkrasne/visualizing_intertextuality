/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/d3-sankey@0.12.3/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{min as n,sum as t,max as o}from"../d3-array@2.12.1/bca3792b.js";import{linkHorizontal as e}from"../d3-shape@1.3.7/9a730356.js";function r(n){return n.target.depth}function i(n){return n.depth}function s(n,t){return t-1-n.height}function f(n,t){return n.sourceLinks.length?n.depth:t-1}function u(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?n(t.sourceLinks,r)-1:0}function c(n){return function(){return n}}function l(n,t){return h(n.source,t.source)||n.index-t.index}function a(n,t){return h(n.target,t.target)||n.index-t.index}function h(n,t){return n.y0-t.y0}function g(n){return n.value}function d(n){return n.index}function y(n){return n.nodes}function k(n){return n.links}function L(n,t){const o=n.get(t);if(!o)throw new Error("missing: "+t);return o}function p({nodes:n}){for(const t of n){let n=t.y0,o=n;for(const o of t.sourceLinks)o.y0=n+o.width/2,n+=o.width;for(const n of t.targetLinks)n.y1=o+n.width/2,o+=n.width}}function w(){let e,r,i,s=0,u=0,w=1,x=1,m=24,v=8,M=d,S=f,b=y,z=k,E=6;function j(){const f={nodes:b.apply(null,arguments),links:z.apply(null,arguments)};return function({nodes:n,links:t}){for(const[t,o]of n.entries())o.index=t,o.sourceLinks=[],o.targetLinks=[];const o=new Map(n.map(((t,o)=>[M(t,o,n),t])));for(const[n,e]of t.entries()){e.index=n;let{source:t,target:r}=e;"object"!=typeof t&&(t=e.source=L(o,t)),"object"!=typeof r&&(r=e.target=L(o,r)),t.sourceLinks.push(e),r.targetLinks.push(e)}if(null!=i)for(const{sourceLinks:t,targetLinks:o}of n)t.sort(i),o.sort(i)}(f),function({nodes:n}){for(const o of n)o.value=void 0===o.fixedValue?Math.max(t(o.sourceLinks,g),t(o.targetLinks,g)):o.fixedValue}(f),function({nodes:n}){const t=n.length;let o=new Set(n),e=new Set,r=0;for(;o.size;){for(const n of o){n.depth=r;for(const{target:t}of n.sourceLinks)e.add(t)}if(++r>t)throw new Error("circular link");o=e,e=new Set}}(f),function({nodes:n}){const t=n.length;let o=new Set(n),e=new Set,r=0;for(;o.size;){for(const n of o){n.height=r;for(const{source:t}of n.targetLinks)e.add(t)}if(++r>t)throw new Error("circular link");o=e,e=new Set}}(f),function(i){const f=function({nodes:n}){const t=o(n,(n=>n.depth))+1,e=(w-s-m)/(t-1),i=new Array(t);for(const o of n){const n=Math.max(0,Math.min(t-1,Math.floor(S.call(null,o,t))));o.layer=n,o.x0=s+n*e,o.x1=o.x0+m,i[n]?i[n].push(o):i[n]=[o]}if(r)for(const n of i)n.sort(r);return i}(i);e=Math.min(v,(x-u)/(o(f,(n=>n.length))-1)),function(o){const r=n(o,(n=>(x-u-(n.length-1)*e)/t(n,g)));for(const n of o){let t=u;for(const o of n){o.y0=t,o.y1=t+o.value*r,t=o.y1+e;for(const n of o.sourceLinks)n.width=n.value*r}t=(x-t+e)/(n.length+1);for(let o=0;o<n.length;++o){const e=n[o];e.y0+=t*(o+1),e.y1+=t*(o+1)}R(n)}}(f);for(let n=0;n<E;++n){const t=Math.pow(.99,n),o=Math.max(1-t,(n+1)/E);V(f,t,o),A(f,t,o)}}(f),p(f),f}function A(n,t,o){for(let e=1,i=n.length;e<i;++e){const i=n[e];for(const n of i){let o=0,e=0;for(const{source:t,value:r}of n.targetLinks){let i=r*(n.layer-t.layer);o+=W(t,n)*i,e+=i}if(!(e>0))continue;let r=(o/e-n.y0)*t;n.y0+=r,n.y1+=r,P(n)}void 0===r&&i.sort(h),C(i,o)}}function V(n,t,o){for(let e=n.length-2;e>=0;--e){const i=n[e];for(const n of i){let o=0,e=0;for(const{target:t,value:r}of n.sourceLinks){let i=r*(t.layer-n.layer);o+=q(n,t)*i,e+=i}if(!(e>0))continue;let r=(o/e-n.y0)*t;n.y0+=r,n.y1+=r,P(n)}void 0===r&&i.sort(h),C(i,o)}}function C(n,t){const o=n.length>>1,r=n[o];J(n,r.y0-e,o-1,t),I(n,r.y1+e,o+1,t),J(n,x,n.length-1,t),I(n,u,0,t)}function I(n,t,o,r){for(;o<n.length;++o){const i=n[o],s=(t-i.y0)*r;s>1e-6&&(i.y0+=s,i.y1+=s),t=i.y1+e}}function J(n,t,o,r){for(;o>=0;--o){const i=n[o],s=(i.y1-t)*r;s>1e-6&&(i.y0-=s,i.y1-=s),t=i.y0-e}}function P({sourceLinks:n,targetLinks:t}){if(void 0===i){for(const{source:{sourceLinks:n}}of t)n.sort(a);for(const{target:{targetLinks:t}}of n)t.sort(l)}}function R(n){if(void 0===i)for(const{sourceLinks:t,targetLinks:o}of n)t.sort(a),o.sort(l)}function W(n,t){let o=n.y0-(n.sourceLinks.length-1)*e/2;for(const{target:r,width:i}of n.sourceLinks){if(r===t)break;o+=i+e}for(const{source:e,width:r}of t.targetLinks){if(e===n)break;o-=r}return o}function q(n,t){let o=t.y0-(t.targetLinks.length-1)*e/2;for(const{source:r,width:i}of t.targetLinks){if(r===n)break;o+=i+e}for(const{target:e,width:r}of n.sourceLinks){if(e===t)break;o-=r}return o}return j.update=function(n){return p(n),n},j.nodeId=function(n){return arguments.length?(M="function"==typeof n?n:c(n),j):M},j.nodeAlign=function(n){return arguments.length?(S="function"==typeof n?n:c(n),j):S},j.nodeSort=function(n){return arguments.length?(r=n,j):r},j.nodeWidth=function(n){return arguments.length?(m=+n,j):m},j.nodePadding=function(n){return arguments.length?(v=e=+n,j):v},j.nodes=function(n){return arguments.length?(b="function"==typeof n?n:c(n),j):b},j.links=function(n){return arguments.length?(z="function"==typeof n?n:c(n),j):z},j.linkSort=function(n){return arguments.length?(i=n,j):i},j.size=function(n){return arguments.length?(s=u=0,w=+n[0],x=+n[1],j):[w-s,x-u]},j.extent=function(n){return arguments.length?(s=+n[0][0],w=+n[1][0],u=+n[0][1],x=+n[1][1],j):[[s,u],[w,x]]},j.iterations=function(n){return arguments.length?(E=+n,j):E},j}function x(n){return[n.source.x1,n.y0]}function m(n){return[n.target.x0,n.y1]}function v(){return e().source(x).target(m)}export{w as sankey,u as sankeyCenter,f as sankeyJustify,i as sankeyLeft,v as sankeyLinkHorizontal,s as sankeyRight};export default null;
